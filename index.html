<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Geräteverwaltung – Hochschule Bochum (azgh)</title>
  <meta name="description" content="Geräteverwaltung im Einmacher-Stil: Übersicht, Gerätesuche, Detailseiten & QR-Codes mit direkten Deep-Links." />
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Icons -->
  <link href="https://unpkg.com/lucide-static@0.453.0/font/lucide.css" rel="stylesheet" />
  <!-- JS libs for QR + ZIP -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.5/build/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <style>
    :root { --bo-green:#00A19A; --bo-dark:#1f2937; }
    .bo-link { color: var(--bo-green); }
    .bo-link:hover { text-decoration: underline; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <!-- Header im Stil der Einmacher-Seite / BO -->
  <header class="bg-white border-b sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center gap-4">
      <a href="#/" class="font-black tracking-wide text-xl"><span class="text-gray-900">BO</span></a>
      <nav class="ml-auto hidden md:flex gap-6 text-sm">
        <a class="hover:underline" href="#/">Start</a>
        <a class="hover:underline" href="#/geraete">Alle Geräte</a>
        <a class="hover:underline" href="#/qr">QR-Codes</a>
        <a class="hover:underline" href="#/hilfe">Hilfe</a>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main id="app" class="max-w-6xl mx-auto px-4 py-8"></main>

  <!-- Footer im BO-Stil -->
  <footer class="mt-16 border-t bg-white">
    <div class="max-w-6xl mx-auto px-4 py-10 grid md:grid-cols-4 gap-8 text-sm">
      <div>
        <div class="text-lg font-semibold mb-2">Informationen</div>
        <ul class="space-y-1">
          <li><a href="#/hilfe" class="bo-link">Hilfe</a></li>
          <li><a href="#/impressum" class="bo-link">Impressum</a></li>
          <li><a href="#/datenschutz" class="bo-link">Datenschutzerklärung</a></li>
        </ul>
      </div>
      <div>
        <div class="text-lg font-semibold mb-2">Im Überblick</div>
        <ul class="space-y-1">
          <li><a href="#/geraete" class="bo-link">Alle Geräte</a></li>
          <li><a href="#/qr" class="bo-link">QR-Codes</a></li>
        </ul>
      </div>
      <div>
        <div class="text-lg font-semibold mb-2">Service</div>
        <ul class="space-y-1">
          <li><a href="#/kontakt" class="bo-link">Kontakt</a></li>
        </ul>
      </div>
      <div>
        <div class="text-lg font-semibold mb-2">Social Media</div>
        <div class="text-gray-400">❌</div>
      </div>
    </div>
    <div class="border-t">
      <div class="max-w-6xl mx-auto px-4 py-6 text-xs text-gray-500">© 2025 Hochschule Bochum – Alle Rechte vorbehalten</div>
    </div>
  </footer>

  <script>
    // ---------- Datenmodell ----------
    // Du kannst hier echte Geräte-Daten pflegen. Beispielhaft generieren wir 1..900.
    const BASE = 'https://youssefazgh.github.io/azgh'; // deine Domain
    const DEVICES = Array.from({ length: 900 }, (_, i) => {
      const id = i + 1;
      return {
        id,
        name: `Gerät ${id}`,
        // EIGENER Deep-Link pro Gerät (hash-route):
        link: `${BASE}/#/geraet/${id}`
      };
    });

    // ---------- Mini Router (hash-basiert) ----------
    const routes = {
      '#/': viewHome,
      '#/geraete': viewAllDevices,
      '#/geraet': viewDevice, // + /:id
      '#/qr': viewQR,
      '#/hilfe': viewHelp,
      '#/impressum': () => staticPage('Impressum', '<p>Inhaltlicher Verantwortlicher …</p>'),
      '#/datenschutz': () => staticPage('Datenschutz', '<p>Hinweise zum Datenschutz …</p>'),
      '#/kontakt': () => staticPage('Kontakt', '<p>Kontaktadresse …</p>'),
    };

    function navigate() {
      const hash = window.location.hash || '#/';
      const [base, , id] = hash.split('/');
      const app = document.getElementById('app');
      (routes[`${base}/`] || routes[base] || viewNotFound)(id, app);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    window.addEventListener('hashchange', navigate);
    window.addEventListener('DOMContentLoaded', navigate);

    // ---------- Views ----------
    function viewHome() {
      const app = document.getElementById('app');
      app.innerHTML = `
        <section class="grid md:grid-cols-2 gap-8 items-center">
          <div>
            <h1 class="text-3xl md:text-4xl font-bold mb-4">Geräteverwaltung</h1>
            <p class="text-gray-600 mb-6">Im Einmacher/BO-Stil: Übersicht, Gerätesuche, Detailseiten mit eigenen Deep-Links und QR-Codes (als Download, nicht auf der Seite angezeigt).</p>
            <div class="flex gap-3">
              <a href="#/geraete" class="px-5 py-3 rounded-xl bg-[var(--bo-green)] text-white font-medium">Alle Geräte</a>
              <a href="#/qr" class="px-5 py-3 rounded-xl border">QR-Codes</a>
            </div>
          </div>
          <div class="bg-white border rounded-2xl p-6 shadow-sm">
            <div class="text-sm text-gray-500 mb-2">Schnellsuche</div>
            <input id="quickSearch" type="search" placeholder="z. B. 123 oder Laptop" class="w-full border rounded-xl px-4 py-3 mb-4" />
            <div id="quickResults" class="grid grid-cols-2 md:grid-cols-3 gap-3 max-h-64 overflow-auto"></div>
          </div>
        </section>
      `;
      const input = document.getElementById('quickSearch');
      const out = document.getElementById('quickResults');
      input.addEventListener('input', () => {
        const q = input.value.trim().toLowerCase();
        const hits = !q ? [] : DEVICES.filter(d => (`${d.id} ${d.name}`.toLowerCase().includes(q))).slice(0, 30);
        out.innerHTML = hits.map(card).join('');
      });
    }

    function viewAllDevices() {
      const app = document.getElementById('app');
      app.innerHTML = `
        <h1 class="text-2xl font-bold mb-4">Alle Geräte</h1>
        <div class="flex items-center gap-3 mb-6">
          <input id="search" type="search" placeholder="Gerät suchen…" class="flex-1 border rounded-xl px-4 py-3" />
          <span class="text-sm text-gray-500">${DEVICES.length} Geräte</span>
        </div>
        <div id="grid" class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
      `;
      const grid = document.getElementById('grid');
      const search = document.getElementById('search');
      const render = (list) => grid.innerHTML = list.map(card).join('');
      render(DEVICES.slice(0, 60));
      search.addEventListener('input', () => {
        const q = search.value.trim().toLowerCase();
        const hits = !q ? DEVICES.slice(0, 200) : DEVICES.filter(d => (`${d.id} ${d.name}`.toLowerCase().includes(q))).slice(0, 200);
        render(hits);
      });
    }

    function viewDevice(id) {
      const app = document.getElementById('app');
      const num = parseInt(id, 10);
      const dev = DEVICES.find(d => d.id === num);
      if (!dev) return viewNotFound();
      app.innerHTML = `
        <nav class="text-sm mb-4"><a class="bo-link" href="#/">Start</a> · <a class="bo-link" href="#/geraete">Alle Geräte</a> · <span>Gerät ${dev.id}</span></nav>
        <h1 class="text-2xl font-bold mb-2">${dev.name}</h1>
        <p class="text-gray-600 mb-6">Eindeutiger Deep-Link zu diesem Gerät: <a class="bo-link" href="${dev.link}">${dev.link}</a></p>
        <div class="grid md:grid-cols-2 gap-6">
          <div class="bg-white border rounded-2xl p-6 shadow-sm">
            <h2 class="font-semibold mb-3">Stammdaten</h2>
            <dl class="grid grid-cols-3 gap-2 text-sm">
              <dt class="text-gray-500">Geräte-ID</dt><dd class="col-span-2">${dev.id}</dd>
              <dt class="text-gray-500">Bezeichnung</dt><dd class="col-span-2">${dev.name}</dd>
              <dt class="text-gray-500">Status</dt><dd class="col-span-2">Aktiv</dd>
            </dl>
          </div>
          <div class="bg-white border rounded-2xl p-6 shadow-sm">
            <h2 class="font-semibold mb-3">QR-Code</h2>
            <p class="text-sm text-gray-600 mb-4">QR-Codes werden nicht überall angezeigt (wie gewünscht). Hier kannst du optional den einzelnen QR-Code herunterladen.</p>
            <canvas id="qrCanvas" class="border rounded-xl"></canvas>
            <div class="mt-3 flex gap-3">
              <button id="dlQR" class="px-4 py-2 rounded-lg border">QR herunterladen</button>
              <a href="#/qr" class="px-4 py-2 rounded-lg bg-[var(--bo-green)] text-white">Alle QR-Codes</a>
            </div>
          </div>
        </div>
      `;
      const canvas = document.getElementById('qrCanvas');
      QRCode.toCanvas(canvas, dev.link, { width: 256, errorCorrectionLevel: 'M' });
      document.getElementById('dlQR').addEventListener('click', () => saveCanvas(canvas, `geraet-${dev.id}.png`));
    }

    function viewQR() {
      const app = document.getElementById('app');
      app.innerHTML = `
        <h1 class="text-2xl font-bold mb-2">QR-Codes</h1>
        <p class="text-gray-600 mb-4">Hier kannst du alle QR-Codes als ZIP-Datei herunterladen. Jeder QR verweist direkt auf die jeweilige Geräte-Detailseite (Deep-Link).</p>
        <div class="flex flex-wrap gap-3 mb-6">
          <button id="btnAll" class="px-5 py-3 rounded-xl bg-[var(--bo-green)] text-white">Alle ${DEVICES.length} als ZIP</button>
          <div class="flex items-center gap-2">
            <input id="rangeFrom" type="number" min="1" max="${DEVICES.length}" value="1" class="w-24 border rounded-xl px-3 py-2" />
            <span>bis</span>
            <input id="rangeTo" type="number" min="1" max="${DEVICES.length}" value="100" class="w-24 border rounded-xl px-3 py-2" />
            <button id="btnRange" class="px-4 py-2 rounded-xl border">Bereich als ZIP</button>
          </div>
        </div>
        <div id="preview" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3"></div>
      `;

      // kleine Vorschau (nicht alle 900 rendern)
      const preview = document.getElementById('preview');
      preview.innerHTML = DEVICES.slice(0, 24).map(d => `
        <div class="bg-white border rounded-xl p-3 text-center">
          <div class="text-xs text-gray-500 mb-2">${d.name}</div>
          <canvas data-id="${d.id}" class="qr min-h-32 mx-auto"></canvas>
        </div>`).join('');
      preview.querySelectorAll('canvas.qr').forEach(cv => {
        const id = parseInt(cv.getAttribute('data-id'), 10);
        const link = DEVICES[id - 1].link;
        QRCode.toCanvas(cv, link, { width: 128, errorCorrectionLevel: 'M' });
      });

      document.getElementById('btnAll').addEventListener('click', () => buildZip(1, DEVICES.length));
      document.getElementById('btnRange').addEventListener('click', () => {
        const a = clamp(parseInt(document.getElementById('rangeFrom').value, 10), 1, DEVICES.length);
        const b = clamp(parseInt(document.getElementById('rangeTo').value, 10), 1, DEVICES.length);
        const from = Math.min(a, b), to = Math.max(a, b);
        buildZip(from, to);
      });
    }

    function viewHelp() {
      staticPage('Hilfe', `
        <ol class="list-decimal pl-6 space-y-3">
          <li>Die Seite nutzt Hash-Routing (URLs wie <code>${BASE}/#/geraet/123</code>) damit jeder QR-Code direkt zur richtigen Detailseite führt.</li>
          <li>Unter <strong>QR-Codes</strong> kannst du alle Codes als ZIP herunterladen – oder nur einen Bereich.</li>
          <li>QR-Codes sind <em>nicht</em> auf den Übersichtsseiten sichtbar, sondern nur optional auf der Detailseite.</li>
          <li>Zum Anpassen der Geräte, bearbeite im Script das Array <code>DEVICES</code> (du kannst echte Namen, Seriennummern usw. vergeben).</li>
        </ol>
      `);
    }

    function staticPage(title, html) {
      const app = document.getElementById('app');
      app.innerHTML = `
        <h1 class="text-2xl font-bold mb-4">${title}</h1>
        <div class="prose max-w-none">${html}</div>
      `;
    }

    function viewNotFound() {
      const app = document.getElementById('app');
      app.innerHTML = `
        <h1 class="text-2xl font-bold mb-2">Seite nicht gefunden</h1>
        <p class="text-gray-600">Bitte über die Navigation fortfahren.</p>
      `;
    }

    // ---------- Helper ----------
    function card(d) {
      return `
        <a href="#/geraet/${d.id}" class="block bg-white border rounded-2xl p-4 hover:shadow-sm transition">
          <div class="text-xs text-gray-500">Geräte-ID</div>
          <div class="font-semibold mb-2">${d.id}</div>
          <div class="text-sm text-gray-700">${d.name}</div>
        </a>`;
    }

    function clamp(n, min, max) { return Math.max(min, Math.min(max, n||min)); }

    function saveCanvas(canvas, filename) {
      canvas.toBlob(blob => saveAs(blob, filename));
    }

    async function buildZip(from, to) {
      const zip = new JSZip();
      const folder = zip.folder('qr-codes');
      // Generiere QR-Codes headless (offscreen canvas)
      for (let id = from; id <= to; id++) {
        const dev = DEVICES[id - 1];
        const tmp = document.createElement('canvas');
        await QRCode.toCanvas(tmp, dev.link, { width: 512, errorCorrectionLevel: 'M' });
        const blob = await new Promise(res => tmp.toBlob(res));
        const arrbuf = await blob.arrayBuffer();
        folder.file(`geraet-${id}.png`, arrbuf);
      }
      const content = await zip.generateAsync({ type: 'blob' });
      saveAs(content, `qr-codes_${from}-${to}.zip`);
    }
  </script>
</body>
</html>
